"use strict";(self.webpackChunkfair_react=self.webpackChunkfair_react||[]).push([[8179],{8179:(e,s,n)=>{n.r(s),n.d(s,{default:()=>L});var t=n(84919),a=n(9950),l=n(28429),o=n(42074),i=n(39564),c=n(94635),r=n(27232),d=(n(47705),n(39402)),u=n(44137),v=n(50288),x=n.n(v),h=n(34691),p=n(55271),b=n(59051),m=n.n(b),j=n(28674),f=n(80387),g=n(41397),k=(n(18538),n(99198)),A=n.n(k),N=n(44414);const L=()=>{const e=a.createRef(),s=(0,j.G)(f.Qg),[n,v]=a.useState(1),[b,k]=a.useState(),[L,C]=a.useState({totalcr:0,totalbalance:0,clientpl:0,exposer:0,totalExposer:0,avl:0}),{socketUser:S}=(0,u.E$)(),{username:E}=(0,l.g)(),[T]=(0,o.ok)(),[w,R]=a.useState(!1),[y,P]=a.useState(!0),[_,U]=a.useState(""),[B,D]=a.useState(null),[F,M]=a.useState(!1),[I,W]=a.useState(null),[Y,O]=a.useState({type:"",username:"",status:"",search:""});a.useMemo((()=>{const{user:e}=s,n=Object.keys(c.T),t=n.indexOf(e.role);return n.slice(t+1).filter((e=>"admin"!==e))}),[s]);a.useEffect((()=>{O((0,t.A)((0,t.A)({},Y),{},{username:E}))}),[E]),a.useEffect((()=>{const e=T.get("search")?T.get("search"):"";H({username:E,search:e,type:""}),v(1)}),[E,T.get("search")]),a.useEffect((()=>{V(b)}),[b]);const H=e=>{e.page||(e.page=1),i.A.getUserList(e).then((s=>{O(e),console.log(s.data.data),k(s.data.data),V(s.data.data.items)}))},G=(e,s,n)=>{const a=b&&b.items.length>0?[...b.items]:[],l=a[e];"user"===n?l.isLogin=s:l.betLock=s,k((0,t.A)((0,t.A)({},b),{},{items:a}));const o={isUserActive:!!l.isLogin&&l.isLogin,isUserBetActive:!!l.betLock&&l.betLock,username:l.username,single:!0};i.A.updateUserAndBetStatus(o).then((()=>{r.oR.success("Status Updated Successfully")})).catch((e=>{const s=e.response.data.message;r.oR.error(s)}))},K=e=>{var s;return(null===(s=e.balance)||void 0===s?void 0:s.profitLoss)||0},Q=e=>{const s=p.Wp.book_new(),n=p.Wp.json_to_sheet(e);p.Wp.book_append_sheet(s,n,"Sheet1");const t=p.M9(s,{bookType:"xlsx",type:"array"}),a=new Blob([t],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});(0,h.saveAs)(a,"users-".concat(m()().format("MMMM-Do-YYYY-h:mm:ss-a"),".xlsx"))},V=e=>{let s={totalcr:0,totalbalance:0,clientpl:0,exposer:0,totalExposer:0,avl:0};var n,a;e&&(null===(n=e.items)||void 0===n||null===(a=n.filter((e=>e.isLogin===y)))||void 0===a||a.map(((e,n)=>{const a=q(e),l=e&&e.balance&&e.balance.casinoexposer?e.balance.casinoexposer:0,o=e&&e.balance&&e.balance.exposer?e.balance.exposer+ +l:+l+0,i=e&&e.balance&&e.balance.balance?e.balance.balance:0,c=s.totalcr+ +(e&&e.creditRefrences?e.creditRefrences:0),r=s.totalbalance+ +a,d=s.clientpl+ +K(e),u=s.totalExposer+ +o,v=s.avl+ +(i-o);s=(0,t.A)((0,t.A)({},s),{totalbalance:r,totalcr:c,clientpl:d,exposer:o,totalExposer:u,avl:v})})));C(s)},X=e=>{const s=(null===e||void 0===e?void 0:e.partnership)||{};return s[4]?s[4].ownRatio:"0"},$=a.useCallback((e=>{var n,t;return s.user.role===c.T.admin||s.user.role===c.T.sadmin||(null===e||void 0===e||null===(n=e.parentStr)||void 0===n?void 0:n[(null===e||void 0===e||null===(t=e.parentStr)||void 0===t?void 0:t.length)-1])===s.user._id}),[s]),q=e=>{var s,n;const t=(null===e||void 0===e?void 0:e.creditRefrences)||0,a=(null===(s=e.balance)||void 0===s?void 0:s.profitLoss)||0;return null===(n=parseFloat(t)+ +parseFloat(a))||void 0===n?void 0:n.toFixed(2)},z=(e,s)=>{e.preventDefault(),P("true"===s),H({username:E,search:"false",type:"",status:s})},J=a.useCallback((0,g.debounce)((e=>{H(e?{username:e,search:"true",type:""}:E?{username:E,search:"false",type:""}:{username:"",search:"false",type:""})}),500),[E]),Z=e=>{var s,n;const t=(null===e||void 0===e||null===(s=e.exposer)||void 0===s?void 0:s.toString())||"0",a=(null===e||void 0===e||null===(n=e.casinoexposer)||void 0===n?void 0:n.toString())||"0";console.log(t);return(parseFloat(t)+ +parseFloat(a)).toFixed(2)};return(0,N.jsx)(N.Fragment,{children:(0,N.jsx)("div",{className:"list-clients-container",children:(0,N.jsxs)("div",{className:"container-fluid",children:[(0,N.jsxs)("div",{className:"clients-top-controls",children:[(0,N.jsxs)("div",{className:"clients-top-left",children:[(s.user.role==c.T.admin||s.user.role==c.T.sadmin)&&(0,N.jsx)("button",{onClick:()=>{S.emit("logoutAll")},className:"btn-logout-all",children:"Logout All Users"}),(0,N.jsx)("button",{onClick:()=>{const e=null===b||void 0===b?void 0:b.items.map((e=>{var s;const{username:n,creditRefrences:t,balance:a,isLogin:l,betLock:o,exposerLimit:i,role:r}=e;return{Username:n,"Credit Refrences":t,Balance:null===a||void 0===a?void 0:a.balance.toFixed(2),"Client Pnl":K(e),Exposer:null===a||void 0===a||null===(s=a.exposer)||void 0===s?void 0:s.toFixed(2),"Available Balance":(((null===a||void 0===a?void 0:a.balance)||0)-((null===a||void 0===a?void 0:a.exposer)||0)).toFixed(2),"Is Login":l,"Bet Lock":o,"Exposer Limit":i,Percentage:0,Role:c.w[r]}}));Q(e)},className:"btn-excel",children:"Excel"}),(0,N.jsx)(x(),{targetRef:e,filename:"users-".concat(m()().format("MMMM-Do-YYYY-h:mm:ss-a"),".pdf"),children:e=>{let{toPdf:s}=e;return(0,N.jsx)("button",{className:"btn-pdf",onClick:s,children:"PDF"})}})]}),(0,N.jsx)("div",{className:"clients-top-right",children:E?(0,N.jsx)(d.A,{to:"/add-user/".concat(E),className:"btn-add-account",children:"Add Account"}):(0,N.jsx)(d.A,{to:"/add-user",className:"btn-add-account",children:"Add Account"})})]}),(0,N.jsxs)("div",{className:"clients-tabs",children:[(0,N.jsx)("button",{className:y?"active":"",onClick:e=>z(e,"true"),children:"Active"}),(0,N.jsx)("button",{className:y?"":"active",onClick:e=>z(e,"false"),children:"Deactive"})]}),(0,N.jsxs)("div",{className:"clients-header-bar",children:[(0,N.jsxs)("div",{className:"clients-search-box",children:[(0,N.jsx)("i",{className:"fas fa-search search-icon"}),(0,N.jsx)("input",{type:"text",placeholder:"Search Username",onChange:e=>J(e.target.value)})]}),(0,N.jsx)("div",{className:"clients-sort-dropdown",children:(0,N.jsxs)("select",{value:_,onChange:e=>{U(e.target.value)},children:[(0,N.jsx)("option",{value:"",children:"Sorting"}),(0,N.jsx)("option",{value:"pl_asc",children:"PL ASC"}),(0,N.jsx)("option",{value:"pl_desc",children:"PL DESC"}),(0,N.jsx)("option",{value:"exp_asc",children:"Expose ASC"}),(0,N.jsx)("option",{value:"exp_desc",children:"Expose DESC"})]})}),(0,N.jsx)("button",{className:"clients-search-btn",onClick:()=>H((0,t.A)((0,t.A)({},Y),{},{search:"true"})),children:"SEARCH"})]}),(0,N.jsx)("div",{className:"clients-table-wrapper",children:(0,N.jsxs)("table",{className:"clients-table",ref:e,children:[(0,N.jsx)("thead",{children:(0,N.jsxs)("tr",{children:[(0,N.jsx)("th",{children:"USERNAME"}),(0,N.jsx)("th",{children:"BALANCE"}),(0,N.jsx)("th",{children:"P/L"}),(0,N.jsx)("th",{children:"EXP"}),(0,N.jsx)("th",{children:"CLIENT SHARE"}),(0,N.jsx)("th",{children:"UP-LINE"}),(0,N.jsx)("th",{children:"STATUS"}),(0,N.jsx)("th",{children:"BET"}),(0,N.jsx)("th",{children:"OPTIONS"})]})}),(0,N.jsx)("tbody",{children:(()=>{if(null===b||void 0===b||!b.items)return[];const e=b.items.filter((e=>y===e.isLogin||e.role===c.T.admin));if(!_)return e;return[...e].sort(((e,s)=>{var n,t,a,l,o,i,c,r,d,u,v,x;switch(_){case"pl_asc":return((null===(n=e.balance)||void 0===n?void 0:n.profitLoss)||0)-((null===(t=s.balance)||void 0===t?void 0:t.profitLoss)||0);case"pl_desc":return((null===(a=s.balance)||void 0===a?void 0:a.profitLoss)||0)-((null===(l=e.balance)||void 0===l?void 0:l.profitLoss)||0);case"exp_asc":return((null===(o=e.balance)||void 0===o?void 0:o.exposer)||0)+((null===(i=e.balance)||void 0===i?void 0:i.casinoexposer)||0)-(((null===(c=s.balance)||void 0===c?void 0:c.exposer)||0)+((null===(r=s.balance)||void 0===r?void 0:r.casinoexposer)||0));case"exp_desc":const h=((null===(d=e.balance)||void 0===d?void 0:d.exposer)||0)+((null===(u=e.balance)||void 0===u?void 0:u.casinoexposer)||0);return((null===(v=s.balance)||void 0===v?void 0:v.exposer)||0)+((null===(x=s.balance)||void 0===x?void 0:x.casinoexposer)||0)-h;default:return 0}}))})().map(((e,n)=>{var t,a,l,o,i;return(0,N.jsxs)("tr",{children:[(0,N.jsx)("td",{children:(0,N.jsxs)("div",{className:"username-badge",children:[(0,N.jsx)("span",{className:"badge-icon",children:"C"}),e.role!==c.T.user?(0,N.jsx)(d.A,{to:"/list-clients/".concat(e.username),style:{color:"white",textDecoration:"none"},children:e.username}):(0,N.jsx)("span",{children:e.username})]})}),(0,N.jsx)("td",{children:q(e)}),(0,N.jsx)("td",{style:{color:((null===e||void 0===e||null===(t=e.balance)||void 0===t?void 0:t.profitLoss)||0)>=0?"#48bb78":"#e53e3e",fontWeight:600},children:(null===e||void 0===e||null===(a=e.balance)||void 0===a||null===(l=a.profitLoss)||void 0===l?void 0:l.toFixed(2))||"0.00"}),(0,N.jsx)("td",{children:Z(null===e||void 0===e?void 0:e.balance)}),(0,N.jsxs)("td",{children:[X(e),".00"]}),(0,N.jsx)("td",{children:(null===s||void 0===s||null===(o=s.user)||void 0===o?void 0:o.role)===c.T.admin?"BTVIP1":null===s||void 0===s||null===(i=s.user)||void 0===i?void 0:i.username}),(0,N.jsx)("td",{children:(0,N.jsx)("div",{className:"status-lock ".concat(null!==e&&void 0!==e&&e.isLogin?"unlocked":"locked"),onClick:()=>G(n,!(null!==e&&void 0!==e&&e.isLogin),"user"),title:null!==e&&void 0!==e&&e.isLogin?"Active":"Inactive",children:(0,N.jsx)("i",{className:"fas ".concat(null!==e&&void 0!==e&&e.isLogin?"fa-unlock":"fa-lock")})})}),(0,N.jsx)("td",{children:(0,N.jsx)("div",{className:"status-lock ".concat(null!==e&&void 0!==e&&e.betLock?"unlocked":"locked"),onClick:()=>G(n,!(null!==e&&void 0!==e&&e.betLock),"bet"),title:null!==e&&void 0!==e&&e.betLock?"Unlocked":"Locked",children:(0,N.jsx)("i",{className:"fas ".concat(null!==e&&void 0!==e&&e.betLock?"fa-unlock":"fa-lock")})})}),(0,N.jsx)("td",{children:(0,N.jsxs)("div",{className:"action-buttons",children:[$(e)&&e.role!==c.T.admin&&(0,N.jsx)(d.A,{to:"/add-user/".concat(e.username),children:(0,N.jsx)("button",{className:"action-btn btn-cr",title:"Credit Reference - Edit User",children:"CR"})}),(0,N.jsx)(d.A,{to:"/bank-deposit/".concat(e.username),children:(0,N.jsx)("button",{className:"action-btn btn-deposit",title:"Bank Deposit",children:"BANK DEPOSIT"})}),(0,N.jsx)(d.A,{to:"/bank-withdraw/".concat(e.username),children:(0,N.jsx)("button",{className:"action-btn btn-withdraw",title:"Bank Withdraw",children:"BANK WITHDRAW"})}),(0,N.jsx)(d.A,{to:"/account-statement/".concat(e.username),children:(0,N.jsx)("button",{className:"action-btn btn-statement",title:"Change Password",children:"CHANGE PASSWORD"})}),(0,N.jsx)(d.A,{to:"/pending-bets/".concat(e.username),children:(0,N.jsx)("button",{className:"action-btn btn-pending",title:"Status",children:"STATUS"})}),$(e)&&(0,N.jsxs)("div",{style:{position:"relative"},children:[(0,N.jsx)("button",{className:"reports-menu-btn",onClick:()=>D(B===n?null:n),title:"More Options",children:"\u22ee"}),B===n&&(0,N.jsxs)("div",{className:"reports-dropdown",children:[(0,N.jsx)(d.A,{to:"/exposure-limit/".concat(e.username,"/exposure"),onClick:()=>D(null),children:"Exposure Limit"}),(0,N.jsx)(d.A,{to:"/general-settings/".concat(e.username),onClick:()=>D(null),children:"General Settings"}),(0,N.jsx)(d.A,{to:"/transaction-password/".concat(e.username),onClick:()=>D(null),children:"Transaction Password"})]})]})]})})]},e._id)}))})]})}),(0,N.jsx)(A(),{breakLabel:"...",nextLabel:">>",forcePage:n-1,onPageChange:e=>{v(e.selected+1),H((0,t.A)((0,t.A)({},Y),{},{page:e.selected+1}))},pageRangeDisplayed:5,pageCount:(null===b||void 0===b?void 0:b.totalPages)||0,containerClassName:"pagination",activeClassName:"active",previousLabel:"<<",breakClassName:"break-me"})]})})})}}}]);